<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Strapi 5 installation, export, import, and transfer guide for Windows. Environment variables, upload plugin config, and data migration.">
  <title>Strapi 5 ‚Äì Install (Windows), Export, Import, Transfer &amp; .env</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; max-width: 1200px; margin: 0 auto; padding: 2rem; color: #333; }
    h1 { font-size: 2.5em; color: #1a1a1a; border-bottom: 3px solid #0066cc; padding-bottom: 0.5rem; }
    h2 { font-size: 1.8em; color: #2d2d2d; margin-top: 2rem; border-left: 4px solid #0066cc; padding-left: 15px; }
    h3 { font-size: 1.4em; color: #333; margin-top: 1.5rem; }
    h4 { font-size: 1.2em; color: #555; }
    ul, ol { margin: 0.5rem 0; }
    li { margin: 0.25rem 0; }
    code { background-color: #e8f4f8 !important; color: #0d3b66 !important; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em; border: 1px solid #b8d4e3; }
    pre, pre code,
    .command-wrap pre, .command-wrap pre code,
    ol pre, ol pre code, ul pre, ul pre code, li pre, li pre code, div pre, div pre code {
      background-color: #e8f4f8 !important; color: #0d3b66 !important; border-color: #b8d4e3;
    }
    pre { padding: 1rem; overflow-x: auto; white-space: pre-wrap; border-radius: 4px; margin: 15px 0; position: relative; border: 1px solid #b8d4e3; }
    pre code { background-color: transparent !important; color: #0d3b66 !important; padding: 0; }
    .command-wrap { position: relative; margin: 15px 0; }
    .command-wrap .copy-btn {
      position: absolute; top: 8px; right: 8px; z-index: 1;
      background-color: #0066cc; color: white; border: none; padding: 6px 12px; border-radius: 4px;
      cursor: pointer; font-size: 0.85em; font-weight: bold; transition: all 0.3s ease;
    }
    .command-wrap .copy-btn:hover { background-color: #0052a3; }
    .command-wrap .copy-btn.copied { background-color: #28a745; }
    a { color: #0066cc; }
    .note, .info { background: #d1ecf1; border-left: 4px solid #0c5460; padding: 0.75rem 1rem; margin: 1rem 0; }
    .warn { background: #fff3cd; border-left: 4px solid #ffc107; padding: 0.75rem 1rem; margin: 1rem 0; }
    .caution { background: #f8d7da; border-left: 4px solid #dc3545; padding: 0.75rem 1rem; margin: 1rem 0; }
    .note code, .note .code-highlight, .info code, .info .code-highlight,
    .warn code, .warn .code-highlight, .caution code, .caution .code-highlight {
      background-color: #e8f4f8; color: #0d3b66; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; border: 1px solid #b8d4e3;
    }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%); color: white; font-weight: bold; text-transform: uppercase; font-size: 0.9em; letter-spacing: 0.5px; }
    tr:nth-child(even) { background-color: #f8f9fa; }
    tr:hover { background-color: #e3f2fd; transition: background-color 0.2s ease; }
    td code { background-color: #e8f4f8; color: #0d3b66; padding: 3px 8px; border-radius: 3px; font-family: 'Courier New', monospace; border: 1px solid #b8d4e3; }
    .section-intro { background: linear-gradient(135deg, #e8f4f8 0%, #d1e7f0 100%); border-left: 4px solid #0066cc; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 8px rgba(0, 102, 204, 0.1); }
    .section-intro code { background-color: #e8f4f8; color: #0d3b66; padding: 3px 8px; border-radius: 3px; border: 1px solid #b8d4e3; }
    @media (max-width: 768px) { body { padding: 10px; } }
  </style>
</head>
<body>
  <h1>Strapi 5 ‚Äì Install (Windows), Export, Import &amp; Transfer</h1>
  <div class="section-intro">
    <p>This document covers:</p>
    <ul>
    <li><strong>Installing Strapi 5 on Windows</strong> ‚Äì prerequisites and setup.</li>
    <li><strong>Configuring the upload (image) plugin</strong> ‚Äì same setup as this project (local provider, security, body limits).</li>
    <li><strong>Environment variables (.env)</strong> ‚Äì which properties you need (no credentials shown).</li>
    <li><strong>API tokens and encryption key</strong> ‚Äì whether you can reuse tokens or the same encryption key across installations.</li>
    <li><strong>Transfer</strong> ‚Äì stream data from one running Strapi instance to another (same schema).</li>
    <li><strong>Export / Import</strong> ‚Äì export to a file, copy the file, then import on the destination.</li>
    <li><strong>Strapi Cloud</strong> ‚Äì deploy and optionally import or transfer data into Cloud.</li>
    </ul>
  </div>

  <nav class="section-intro toc" aria-label="Table of contents">
    <h3 id="toc">Table of Contents</h3>
    <ol>
      <li><a href="#install">Installing Strapi 5 on Windows</a></li>
      <li><a href="#upload">Configuring the upload plugin</a></li>
      <li><a href="#env">Environment variables</a></li>
      <li><a href="#tokens">API tokens and encryption key</a></li>
      <li><a href="#prereq">Prerequisites</a></li>
      <li><a href="#transfer">Option A ‚Äì Transfer</a></li>
      <li><a href="#export-import">Option B ‚Äì Export then Import</a></li>
      <li><a href="#included">What is included / excluded</a></li>
      <li><a href="#cloud">Strapi Cloud</a></li>
      <li><a href="#cloud-troubleshoot">Strapi Cloud ‚Äì Post-transfer troubleshooting</a></li>
      <li><a href="#quickref">Quick reference</a></li>
      <li><a href="#docs">Official documentation</a></li>
    </ol>
  </nav>

  <div class="caution">
    <strong>Admin users and API tokens are never transferred or exported.</strong> You must recreate admin users (and API tokens) on the destination after any migration. The <code class="code-highlight">createdBy</code> and <code class="code-highlight">updatedBy</code> fields in content will be empty after import/transfer.
  </div>

  <h2 id="install">1. Installing Strapi 5 on Windows</h2>
  <ol>
    <li><strong>Node.js</strong> ‚Äì Install Node.js LTS (e.g. 20.x or 22.x) from <a href="https://nodejs.org" target="_blank" rel="noopener">nodejs.org</a>. Use the Windows installer. Restart the terminal (or IDE) after installation.</li>
    <li><strong>npm</strong> ‚Äì Comes with Node.js. Verify: <code>node -v</code> and <code>npm -v</code>.</li>
    <li><strong>Create a new project</strong> (or clone this repo):
      <pre><code>npx create-strapi-app@latest my-project --quickstart</code></pre>
      <code>--quickstart</code> uses SQLite and opens the admin in the browser. For a custom database, omit <code>--quickstart</code> and follow the prompts.
    </li>
    <li><strong>Or use this project</strong> ‚Äì Clone the repo, then in the project root:
      <pre><code>npm install</code></pre>
      Copy <code>.env.example</code> to <code>.env</code> (Windows: <code>copy .env.example .env</code>; macOS/Linux: <code>cp .env.example .env</code>). Edit <code>.env</code> and set the required variables (see ¬ß3). Do not commit <code>.env</code>.
    </li>
    <li><strong>Build and run</strong>:
      <pre><code>npm run build
npm run develop</code></pre>
      For production: <code>npm run start</code>. Admin is usually at <code>http://localhost:1337/admin</code>.
    </li>
  </ol>
  <p>If you see permission or path-length issues on Windows, run the terminal as Administrator or enable long paths (e.g. <code>git config core.longpaths true</code> in the repo).</p>

  <h2 id="upload">2. Configuring the upload (image) plugin</h2>
  <p>This project configures the built-in upload plugin so dashboard image uploads work and do not hang (Strapi 5 requires an explicit upload security configuration). Apply the same on the other machine (or in Strapi Cloud if you deploy this code).</p>
  <h3>2.1 Upload plugin ‚Äì <code>config/plugins.js</code></h3>
  <p>Create or merge this in <code>config/plugins.js</code>:</p>
  <pre><code>module.exports = ({ env }) => ({
  upload: {
    config: {
      provider: 'local',
      sizeLimit: 250 * 1024 * 1024, // 250 MB (must match body middleware below)
      security: {
        allowedTypes: ['image/*', 'video/*', 'audio/*', 'application/pdf', 'application/*'],
        deniedTypes: ['application/x-sh', 'application/x-executable', 'application/x-dosexec'],
      },
    },
  },
});</code></pre>
  <p>Without <code>security</code>, Strapi 5 can log &quot;No upload security configuration found&quot; and dashboard uploads may hang or fail.</p>
  <h3>2.2 Body middleware ‚Äì <code>config/middlewares.js</code></h3>
  <p>Ensure the <code>strapi::body</code> middleware allows large multipart uploads (e.g. 250 MB). Replace or add this entry in the <code>config/middlewares.js</code> array:</p>
  <pre><code>{
  name: 'strapi::body',
  config: {
    formLimit: '256mb',
    jsonLimit: '256mb',
    textLimit: '256mb',
    formidable: {
      maxFileSize: 250 * 1024 * 1024, // 250 MB ‚Äî multipart uploads (Media Library)
    },
  },
},</code></pre>
  <p>Keep other middlewares (e.g. <code>strapi::logger</code>, <code>strapi::security</code>, <code>strapi::cors</code>, etc.) as in the default or this project. Restart Strapi after changing <code>plugins.js</code> or <code>middlewares.js</code>.</p>

  <h2 id="env">3. Environment variables (.env)</h2>
  <p>Only <strong>property names</strong> are listed below. Set values in <code>.env</code>; never commit real credentials. Use <code>.env.example</code> as a template and copy it to <code>.env</code> then fill in.</p>
  <table>
    <thead>
      <tr><th>Property</th><th>Required</th><th>Purpose</th></tr>
    </thead>
    <tbody>
      <tr><td><code>HOST</code></td><td>Optional</td><td>Server bind address (default <code>0.0.0.0</code>).</td></tr>
      <tr><td><code>PORT</code></td><td>Optional</td><td>Server port (default <code>1337</code>).</td></tr>
      <tr><td><code>APP_KEYS</code></td><td>Yes</td><td>Comma-separated list of at least one key (e.g. <code>key1,key2</code>). Used for session signing.</td></tr>
      <tr><td><code>API_TOKEN_SALT</code></td><td>Yes</td><td>Salt for hashing API tokens (admin-created tokens).</td></tr>
      <tr><td><code>ENCRYPTION_KEY</code></td><td>Yes</td><td>Used by admin panel (e.g. encrypting transfer tokens).</td></tr>
      <tr><td><code>ADMIN_JWT_SECRET</code></td><td>Yes</td><td>Secret for admin JWT (admin login).</td></tr>
      <tr><td><code>TRANSFER_TOKEN_SALT</code></td><td>Yes (if using transfer)</td><td>Salt for transfer tokens (data transfer feature).</td></tr>
      <tr><td><code>JWT_SECRET</code></td><td>Yes (if using Users &amp; Permissions)</td><td>Secret for API JWT (front-end / plugin users).</td></tr>
      <tr><td><code>DATABASE_CLIENT</code></td><td>Optional</td><td><code>sqlite</code>, <code>postgres</code>, or <code>mysql</code>. Default <code>sqlite</code>.</td></tr>
      <tr><td><code>DATABASE_FILENAME</code></td><td>SQLite</td><td>Path to SQLite file (e.g. <code>.tmp/data.db</code>).</td></tr>
      <tr><td><code>DATABASE_URL</code></td><td>Postgres</td><td>Full connection string for PostgreSQL.</td></tr>
      <tr><td><code>DATABASE_HOST</code>, <code>DATABASE_PORT</code>, <code>DATABASE_NAME</code>, <code>DATABASE_USERNAME</code>, <code>DATABASE_PASSWORD</code></td><td>MySQL/Postgres</td><td>Connection details when not using <code>DATABASE_URL</code>.</td></tr>
      <tr><td><code>DATABASE_SSL</code>, <code>DATABASE_SSL_*</code></td><td>Optional</td><td>SSL options for database (e.g. <code>DATABASE_SSL_KEY</code>, <code>DATABASE_SSL_CERT</code>).</td></tr>
      <tr><td><code>DATABASE_SCHEMA</code></td><td>Optional (Postgres)</td><td>Schema name (default <code>public</code>).</td></tr>
      <tr><td><code>STRAPI_DATA_IMPORT_PROJECT_CLONE_DIR</code>, <code>TENANT_ID</code></td><td>Optional</td><td>Used by this project‚Äôs directory import script only; not required for a plain Strapi run.</td></tr>
      <tr><td><code>DATABASE_CONNECTION_TIMEOUT</code></td><td>Optional</td><td>Knex connection acquire timeout (ms). Default <code>60000</code>. Set <code>600000</code> (10 min) or higher in <code>.env</code> before running <code>strapi import</code> to reduce <code>KnexTimeoutError</code> risk with SQLite (see ¬ß7.3.1).</td></tr>
    </tbody>
  </table>
  <p>Summary: for a minimal run you need <code>APP_KEYS</code>, <code>API_TOKEN_SALT</code>, <code>ENCRYPTION_KEY</code>, <code>ADMIN_JWT_SECRET</code>, and <code>JWT_SECRET</code> (if using API users). For transfer, add <code>TRANSFER_TOKEN_SALT</code>. For Postgres, set <code>DATABASE_CLIENT=postgres</code> and <code>DATABASE_URL</code> (or individual <code>DATABASE_*</code>). For SQLite, default <code>DATABASE_FILENAME</code> is usually enough.</p>

  <h3>3.1 API token you copy (View/Copy in admin) ‚Äì where does it go?</h3>
  <p>The token you copy from <strong>Settings ‚Üí API Tokens ‚Üí Create (or View)</strong> is <strong>not</strong> stored in Strapi‚Äôs <code>.env</code>. It is the value your <strong>application</strong> (e.g. frontend, mobile app, Postman) uses when calling the Strapi API (e.g. <code>Authorization: Bearer &lt;token&gt;</code>).</p>
  <ul>
    <li>Put it in your <strong>app‚Äôs</strong> <code>.env</code>, for example: <code>STRAPI_API_TOKEN=&lt;paste the token here&gt;</code>, or <code>NEXT_PUBLIC_STRAPI_API_TOKEN=‚Ä¶</code> if the frontend needs it.</li>
    <li>Strapi‚Äôs own <code>.env</code> has <strong>no property</strong> for that token string. The server uses <code>API_TOKEN_SALT</code> (a secret used to hash and verify tokens), not the token value itself.</li>
  </ul>

  <h3>3.2 Where to get values for .env and reusing from this project</h3>
  <p>On a <strong>new machine</strong> you can either generate new secrets or reuse values from the existing project.</p>
  <table>
    <thead>
      <tr><th>Property</th><th>Where to get it / reuse?</th></tr>
    </thead>
    <tbody>
      <tr><td><code>APP_KEYS</code></td><td>Generate new, or copy from this project. Need at least one key; often two comma-separated: <code>key1,key2</code>.</td></tr>
      <tr><td><code>API_TOKEN_SALT</code></td><td>Generate new, or copy from this project.</td></tr>
      <tr><td><code>ENCRYPTION_KEY</code></td><td>Generate new, or copy from this project.</td></tr>
      <tr><td><code>ADMIN_JWT_SECRET</code></td><td>Generate new, or copy from this project.</td></tr>
      <tr><td><code>JWT_SECRET</code></td><td>Generate new, or copy from this project (only if you use Users &amp; Permissions API).</td></tr>
      <tr><td><code>TRANSFER_TOKEN_SALT</code></td><td>Generate new, or copy from this project (only if you use Transfer).</td></tr>
      <tr><td><code>HOST</code>, <code>PORT</code></td><td>Optional; e.g. <code>0.0.0.0</code> and <code>1337</code>. Reuse or leave default.</td></tr>
      <tr><td><code>DATABASE_*</code></td><td>For SQLite: often just <code>DATABASE_FILENAME</code>. For Postgres: <code>DATABASE_CLIENT=postgres</code> and <code>DATABASE_URL</code> (or host/port/name/user/password). Reuse from this project if the new machine uses the same DB; otherwise set new values for the new DB.</td></tr>
    </tbody>
  </table>
  <p><strong>Reusing from this project:</strong> You can copy the <strong>entire</strong> <code>.env</code> from this project to the new machine. Then only adjust <code>DATABASE_*</code> if the new machine uses a different database (e.g. new Postgres URL or a different SQLite path).</p>
  <p><strong>Generating new values</strong> (if you do not reuse): run the following once per secret; for <code>APP_KEYS</code> run it twice and set <code>APP_KEYS=first,second</code>:</p>
  <pre><code>node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"</code></pre>

  <h2 id="tokens">4. API tokens and encryption key ‚Äì reuse across installations?</h2>
  <ul>
    <li><strong>API tokens (admin-created) / JWT</strong> ‚Äì <strong>No.</strong> Export and transfer do <strong>not</strong> include API tokens or admin users. You cannot copy the same API token from this installation and use it on another. Each installation has its own tokens (and salts). After import or transfer, create new API tokens (and admin users) on the destination. The token value you see in the admin is only shown once; it is hashed with <code>API_TOKEN_SALT</code> in the database, so even with the same DB copy, the salt on the other machine would differ unless you deliberately copy <code>API_TOKEN_SALT</code> and the DB ‚Äì still not recommended; create new tokens on the new instance.</li>
    <li><strong>Export file encryption key (<code>-k</code>)</strong> ‚Äì <strong>Yes.</strong> The key you use with <code>strapi export -k "‚Ä¶"</code> and <code>strapi import -k "‚Ä¶"</code> is only for encrypting/decrypting the export file. You can use the same key on the source (for export) and on the destination (for import), or any secure key you prefer on the destination. It does not affect API tokens or JWT.</li>
  </ul>

  <h2 id="prereq">5. Prerequisites (transfer and export/import)</h2>
  <ul>
    <li><strong>Identical schema</strong> ‚Äì Source and destination must have the same content types (same project code or a copy). Content type names, attributes, and relations must match.</li>
    <li><strong>Strapi 5</strong> ‚Äì Commands and behavior described here are for Strapi 5.</li>
    <li>For <strong>transfer</strong>: both instances must be runnable and reachable (destination first); you need a <strong>transfer token</strong> from the destination.</li>
    <li>For <strong>export/import</strong>: you need the export file and (if encrypted) the encryption key on the destination.</li>
  </ul>

  <h2 id="transfer">6. Option A ‚Äì Transfer (stream to another machine)</h2>
  <p>Use this when you can run both Strapi instances and want to push or pull data over the network. Data is streamed; no intermediate file.</p>

  <h3>6.1 Enable transfer tokens (destination)</h3>
  <ol>
    <li>On the <strong>destination</strong> machine, ensure <code>config/admin.js</code> has a transfer token salt (this project uses <code>env('TRANSFER_TOKEN_SALT')</code>). Set <code>TRANSFER_TOKEN_SALT</code> in <code>.env</code> (e.g. a long random string).</li>
    <li>Build and start Strapi on the destination: <code>npm run build</code> then <code>npm run start</code> (or <code>npm run develop</code> for dev).</li>
    <li>Open the admin panel (e.g. <code>http://destination-server:1337/admin</code>), register the first admin user if needed.</li>
    <li>Go to <strong>Settings ‚Üí Global settings ‚Üí Transfer Tokens</strong>.</li>
    <li>Click <strong>Create new Transfer Token</strong>. Set name, optional description, duration (e.g. 30 days), and <strong>Token type</strong>:
      <ul>
        <li><strong>Push</strong> ‚Äì allows transfers from another instance <em>into</em> this one (use when you run <code>strapi transfer --to &lt;this-admin-url&gt;</code> from source).</li>
        <li><strong>Pull</strong> ‚Äì allows this instance to pull from another (use when you run <code>strapi transfer --from &lt;source-admin-url&gt;</code> on destination).</li>
        <li><strong>Full Access</strong> ‚Äì both.</li>
      </ul>
    </li>
    <li>Save and <strong>copy the token immediately</strong> (it is shown only once). Store it securely (e.g. in a password manager or env var <code>STRAPI_TRANSFER_TOKEN</code> on the source machine).</li>
  </ol>

  <h3>6.2 Push data from source to destination</h3>
  <ol>
    <li>On the <strong>source</strong> machine, in the project root (same codebase as destination), run:
      <pre><code>npm run strapi transfer -- --to https://destination-server.example.com/admin</code></pre>
      Use the full URL to the <strong>admin</strong> (including <code>/admin</code>). For local testing: <code>http://localhost:1337/admin</code> or <code>http://127.0.0.1:1337/admin</code>.
    </li>
    <li>When prompted, paste the <strong>destination</strong> transfer token (Push or Full Access).</li>
    <li>Confirm when asked: <em>"The transfer will delete all of the remote Strapi assets and its database. Are you sure you want to proceed?"</em></li>
  </ol>
  <p>To avoid prompts (e.g. in scripts):</p>
  <pre><code>npm run strapi transfer -- --to https://destination-server.example.com/admin --to-token YOUR_TRANSFER_TOKEN --force</code></pre>

  <h3>6.3 Pull data from source into destination</h3>
  <p>Instead of running the command on the source, run it on the <strong>destination</strong> and pull from the source:</p>
  <ol>
    <li>Start the <strong>source</strong> Strapi server and ensure it is reachable from the destination (URL and firewall).</li>
    <li>On the destination machine, in the project root:
      <pre><code>npm run strapi transfer -- --from https://source-server.example.com/admin</code></pre>
    </li>
    <li>When prompted, paste the <strong>source</strong> transfer token (Pull or Full Access).</li>
    <li>Confirm the warning (local database and assets will be replaced).</li>
  </ol>

  <div class="warn">
    <strong>Limitations:</strong> If the destination uses SQLite, other DB connections are blocked during transfer. If you use WebSockets or Socket.io, temporarily disable them or use a different port/route, or transfer may fail.
  </div>

  <h2 id="export-import">7. Option B ‚Äì Export then Import (file-based)</h2>
  <p>Use this when you cannot run both instances at once, or you want a backup file to copy to another machine (or to Strapi Cloud).</p>

  <h3>7.1 Export on the source machine</h3>
  <ol>
    <li>On the <strong>source</strong> machine, in the project root, run one of the following.</li>
    <li><strong>Default (encrypted + compressed)</strong> ‚Äì you will be prompted for an encryption key, or pass it with <code>-k</code>:
      <pre><code>npm run strapi export -- -f my-export
# Or with key (store this key securely; you need it for import):
npm run strapi export -- -f my-export -k "your-secure-encryption-key"</code></pre>
      This creates <code>my-export.tar.gz.enc</code> in the project root.
    </li>
    <li><strong>Without encryption</strong> (easier for local copy, less secure):
      <pre><code>npm run strapi export -- --no-encrypt -f my-export</code></pre>
      Creates <code>my-export.tar.gz</code>.
    </li>
    <li><strong>Plain tar</strong> (no compression, no encryption) ‚Äì useful to inspect or edit before import:
      <pre><code>npm run strapi export -- --no-encrypt --no-compress -f my-export</code></pre>
      Creates <code>my-export.tar</code>. You can extract it and inspect <code>configuration/</code>, <code>entities/</code>, <code>links/</code>, <code>schemas/</code>, <code>metadata.json</code>.
    </li>
  </ol>
  <p>Then <strong>copy the export file</strong> to the destination machine (or to Strapi Cloud if you use import there ‚Äì see Strapi Cloud docs).</p>

  <h3>7.2 Import on the destination machine</h3>
  <ol>
    <li>On the <strong>destination</strong>, use the <strong>same project code</strong> (same schema). Place the export file in the project root or note its path.</li>
    <li>Run (on Windows use a full path in double quotes):
      <pre><code>npm run strapi import -- -f "C:\project_workspace\strapi-editorial-template\my-export.tar.gz"</code></pre>
      If the file is encrypted, you will be prompted for the key, or pass it:
      <pre><code>npm run strapi import -- -f "C:\project_workspace\strapi-editorial-template\my-export.tar.gz.enc" -k "your-secure-encryption-key"</code></pre>
    </li>
    <li>For non-interactive use: <code>--force</code> (and <code>-k</code> for encrypted files):
      <pre><code>npm run strapi import -- -f "C:\project_workspace\strapi-editorial-template\my-export.tar.gz.enc" -k "your-secure-encryption-key" --force</code></pre>
    </li>
    <li><strong>Windows ‚Äì full command (plain .tar, non-interactive):</strong>
      <pre><code>npm run strapi import -- -f "E:\project_workspace\strapi-editorial-template\my-export-1.tar" --force</code></pre>
      Replace the path with your export file location. For encrypted files, add <code>-k "your-encryption-key"</code> before <code>--force</code>.
    </li>
    <li>Confirm when asked: the import <strong>deletes all existing data</strong> (database and uploads) before importing.</li>
  </ol>
  <div class="caution">
    Import <strong>replaces</strong> the destination database and uploads. Admin users are not in the export; recreate them on the destination after import.
  </div>

  <h3>7.2.1 Preserving publishedAt dates (Editorial Articles / news)</h3>
  <p>Strapi import can reset <code>publishedAt</code> to the import date instead of keeping the original publication date from the source. To restore the correct dates for articles/news <strong>after import</strong>:</p>
  <ol>
    <li>Stop Strapi on the destination machine.</li>
    <li>Run the restore script, passing the path to the export file:
      <pre><code>npm run restore:article_dates_from_export -- "E:\project_workspace\strapi-editorial-template\my-export-1.tar"</code></pre>
      Or set the path via environment variable:
      <pre><code>EXPORT_TAR=my-export-1.tar npm run restore:article_dates_from_export</code></pre>
    </li>
    <li>Restart Strapi. Editorial Articles (news) should now show the original <code>publishedAt</code> dates.</li>
  </ol>
  <p>The script reads <code>entities/*.jsonl</code> from the export file and updates the <code>articles</code> table for any Editorial Article (news) whose <code>publishedAt</code> differs from the export. Articles/news are matched by <code>documentId</code> or <code>slug</code>.</p>

  <h2>7.3 Import performance ‚Äì why it is slow and how to speed it up</h2>
  <p><code>strapi import</code> is often very slow for large exports (especially those with many assets). A 373 MB export can take <strong>several hours</strong> instead of minutes.</p>

  <h3>Why import is slow</h3>
  <ul>
    <li><strong>Known issue</strong> ‚Äì Reported import speeds of ~20‚Äì45 KB/s even for local, unencrypted files.</li>
    <li><strong>Asset bottleneck</strong> ‚Äì The import processes each asset file by repeatedly scanning the archive for matching metadata (O(n¬≤) behavior). With thousands of images, this becomes extremely slow.</li>
    <li><strong>SQLite</strong> ‚Äì Writes and indexing add overhead, but the main bottleneck is the import implementation, not the database.</li>
  </ul>

  <h3>What helps today</h3>
  <table>
    <thead>
      <tr><th>Action</th><th>Effect</th></tr>
    </thead>
    <tbody>
      <tr><td>Use plain <code>.tar</code> (no compression)</td><td>Faster than <code>.tar.gz</code>; skip decompression during import.</td></tr>
      <tr><td>Avoid encryption</td><td>Export with <code>--no-encrypt</code>; decryption adds overhead.</td></tr>
      <tr><td>Try <strong>Transfer</strong> instead</td><td>Stream directly between running instances; may be faster in some setups.</td></tr>
      <tr><td>Manual copy (advanced)</td><td>Copy the SQLite DB file and <code>public/uploads</code> folder; faster but only when schemas match exactly.</td></tr>
    </tbody>
  </table>

  <h3>Strapi Cloud and database change</h3>
  <ul>
    <li><strong>Strapi Cloud</strong> uses PostgreSQL. Import speed is still limited by the same bottleneck; expect similar runtimes until the fix is merged.</li>
    <li><strong>Switching to PostgreSQL</strong> locally can improve general DB performance but does <strong>not</strong> fix the slow asset import. The bottleneck is in the import logic, not the database.</li>
  </ul>

  <h3>PR #25268 ‚Äì ‚Äúfix: implement asset metadata cache‚Äù</h3>
  <p>An open community PR addresses the main cause of slow imports by caching asset metadata up front (O(n) instead of O(n¬≤)).</p>
  <ul>
    <li><strong>PR:</strong> <a href="https://github.com/strapi/strapi/pull/25268" target="_blank" rel="noopener">https://github.com/strapi/strapi/pull/25268</a></li>
    <li><strong>Result for one user:</strong> ~25k assets (~3 GB): 18 KB/s ‚Üí ~118 MB/s; import time from hours to ~27 seconds.</li>
    <li><strong>Status:</strong> Open (as of early 2026); not yet merged into Strapi.</li>
  </ul>

  <h3>Applying PR #25268 locally (advanced)</h3>
  <p>If you are comfortable building from source, you can apply the PR to your Strapi installation. This requires Node.js, Yarn, and Git.</p>
  <ol>
    <li><strong>Clone the Strapi monorepo</strong> (use a sibling directory to your project):
      <pre><code>cd E:\project_workspace
git clone https://github.com/strapi/strapi.git strapi-source
cd strapi-source</code></pre>
    </li>
    <li><strong>Fetch and checkout the PR branch</strong>:
      <pre><code>git fetch origin pull/25268/head:fix/slow-assets-import
git checkout fix/slow-assets-import</code></pre>
    </li>
    <li><strong>Install dependencies and build</strong> (this can take several minutes):
      <pre><code>yarn install
yarn build</code></pre>
      If <code>yarn build</code> fails or is slow, try building only the data-transfer package:
      <pre><code>cd packages/core/data-transfer
yarn build
cd ../../..</code></pre>
    </li>
    <li><strong>Link the patched package into your Strapi project</strong>:
      <pre><code>cd packages/core/data-transfer
yarn link
cd E:\project_workspace\strapi-editorial-template
yarn link @strapi/data-transfer</code></pre>
    </li>
    <li><strong>Run the import</strong> in your project:
      <pre><code>npm run strapi import -- -f "E:\project_workspace\strapi-editorial-template\my-export-1.tar" --force</code></pre>
    </li>
  </ol>
  <div class="warn">
    <strong>Caveats:</strong> The linked package may not match your Strapi version exactly. If you see errors, revert with <code class="code-highlight">yarn unlink @strapi/data-transfer</code> and <code class="code-highlight">yarn install</code>. Re-apply the link after every <code class="code-highlight">npm install</code> or <code class="code-highlight">yarn install</code> in your project. Check the PR page for updates and whether it has been merged.
  </div>

  <h3>7.3.1 KnexTimeoutError during import (SQLite)</h3>
  <p>During long imports (many assets), you may see:</p>
  <pre><code>KnexTimeoutError: Knex: Timeout acquiring a connection. The pool is probably full.
at ... weekly-metrics.js</code></pre>
  <p>This happens when the upload plugin‚Äôs scheduled metrics job tries to use the database while the import is holding the SQLite connection. SQLite allows only one writer at a time.</p>
  <p><strong>Workaround:</strong> Before running import, set a higher connection timeout in <code>.env</code>:</p>
  <pre><code>DATABASE_CONNECTION_TIMEOUT=600000</code></pre>
  <p>This sets 10 minutes (600000 ms). For very large imports, you can use <code>900000</code> (15 min) or <code>1800000</code> (30 min). The metrics job will wait longer before timing out; if the import finishes or briefly releases the connection, the job may succeed.</p>
  <p><strong>Better fix:</strong> Apply <a href="https://github.com/strapi/strapi/pull/25268" target="_blank" rel="noopener">PR #25268</a> (see ¬ß7.3) to speed up asset import (hours ‚Üí minutes), which reduces the window for this error. Alternatively, use PostgreSQL instead of SQLite for large datasets; it handles concurrent connections better.</p>

  <h2 id="included">8. What is included / excluded</h2>
  <table>
    <thead>
      <tr><th>Data</th><th>Transfer</th><th>Export/Import</th></tr>
    </thead>
    <tbody>
      <tr><td>Content (entities, relations)</td><td>Yes</td><td>Yes</td></tr>
      <tr><td>Uploaded files (media)</td><td>Yes</td><td>Yes (if stored locally; not from 3rd party providers like S3/Cloudinary)</td></tr>
      <tr><td>Project configuration</td><td>Yes</td><td>Yes</td></tr>
      <tr><td>Schemas</td><td>Yes (must match)</td><td>Yes (must match)</td></tr>
      <tr><td>Admin users</td><td>No</td><td>No</td></tr>
      <tr><td>API tokens</td><td>No</td><td>No</td></tr>
      <tr><td>createdBy / updatedBy</td><td>N/A</td><td>Empty after import</td></tr>
    </tbody>
  </table>

  <h2 id="cloud">9. Strapi Cloud</h2>
  <p>You can run the same Strapi project on Strapi Cloud and optionally move your data there.</p>

  <h3>9.1 Deploy the project to Strapi Cloud (first time)</h3>
  <ol>
    <li>Prerequisites: Google, GitHub, or GitLab account; local Strapi project <strong>under 100MB</strong>.</li>
    <li>In the project root:
      <pre><code>npx strapi login</code></pre>
      Complete login in the browser (Google/GitHub/GitLab).
    </li>
    <li>Deploy:
      <pre><code>npx strapi deploy</code></pre>
      This creates a new Strapi Cloud project (Free plan) and deploys your code. It may take a few minutes.</li>
    <li>After deploy, the Cloud dashboard will show your project URL (e.g. <code>https://your-project.strapiapp.com</code>). Open the admin at <code>https://your-project.strapiapp.com/admin</code> and create your first admin user.</li>
  </ol>

  <h3>9.2 Import data into Strapi Cloud</h3>
  <p>You have two main options:</p>
  <ul>
    <li><strong>Transfer (recommended)</strong> ‚Äì From your self-hosted machine, run <code>strapi transfer --to https://your-project.strapiapp.com/admin</code>. Create a <strong>Transfer Token</strong> in the Strapi Cloud admin (Settings ‚Üí Global settings ‚Üí Transfer Tokens) with type <strong>Push</strong> or <strong>Full Access</strong>, then use that token when prompted. This streams content, files, and config into Cloud (same schema required).</li>
    <li><strong>Export then Import</strong> ‚Äì Export from self-hosted (see ¬ß3.1). Strapi Cloud projects can run CLI commands in some setups; refer to the <a href="https://docs.strapi.io/cloud" target="_blank" rel="noopener">Strapi Cloud documentation</a> for how to run <code>strapi import</code> on your Cloud project (e.g. via Cloud dashboard or support). If Cloud does not expose a shell, use <strong>transfer</strong> instead.</li>
  </ul>
  <p>After data is in Cloud, recreate admin users (and API tokens) in the Cloud admin as needed.</p>

  <h3>9.3 Link an existing Strapi Cloud project</h3>
  <p>If you already created a project in the Strapi Cloud dashboard and want to link your local repo to it:</p>
  <pre><code>npx strapi link</code></pre>
  <p>Follow the prompts to select the Cloud project. Then you can deploy with <code>npx strapi deploy</code> or use transfer/import as above.</p>

  <h2 id="cloud-troubleshoot">10. Strapi Cloud ‚Äì Post-transfer troubleshooting</h2>
  <p>This section summarizes what appears in Strapi Cloud logs after a data transfer (push with token), why uploads return 404, and the recommended fix. It ties together bootstrap fixes, media 404s, and S3 feasibility.</p>

  <h3>10.1 What the logs show</h3>
  <p><strong>Bootstrap (addressed in this project):</strong> The following are fixed via <code>src/bootstrap.js</code>:</p>
  <ul>
    <li><strong>Homepage crash</strong> ‚Äì <code>Cannot read properties of undefined (reading 'settings')</code> in <code>getContentTypesMeta</code>. Fix: <code>ensureContentManagerConfigurations()</code> so every content type has a configuration in core-store (including <code>mainField</code> and <code>settings</code>).</li>
    <li><strong>Bishop list 400</strong> ‚Äì <code>sort=undefined:undefined</code>. Fix: <code>ensureCollectionTypesHaveDefaultSort()</code> so all API collection types have <code>defaultSortBy</code> and <code>defaultSortOrder</code> (using mainField or documentId as fallback).</li>
  </ul>
  <p><strong>After transfer on Cloud you may still see:</strong></p>
  <ul>
    <li><strong>Upload 404s</strong> ‚Äì e.g. <code>GET /uploads/mar_chrisostomos_1520bbb7f7.jpeg</code> ‚Üí 404. File <em>records</em> exist in the database (from the transfer), but the <em>actual files</em> are not on the Cloud server‚Äôs filesystem.</li>
    <li><strong>Data transfer behavior</strong> ‚Äì Strapi Data Transfer (push with token) moves database content and can stream assets; on Strapi Cloud the runtime filesystem is ephemeral or not populated with your local <code>public/uploads</code>, so media files often do not exist where the app serves them ‚Üí 404.</li>
  </ul>

  <h3>10.2 Why images 404 after push/import to Strapi Cloud</h3>
  <p>Transfer creates or updates <strong>media entries</strong> in the database (admin shows files and URLs). The <strong>binary files</strong> either are not included in what gets deployed to Cloud, or are stored in a different/transient filesystem that does not match the app‚Äôs <code>/uploads</code> serving. So when the app or admin requests <code>/uploads/...</code>, the file is not there ‚Üí <strong>404</strong>.</p>

  <h3>10.3 Best fix for 404s: external object storage (e.g. S3)</h3>
  <p>Use <strong>one external object store</strong> (e.g. S3 or S3-compatible) and point <strong>both</strong> local and Strapi Cloud to it. Then:</p>
  <ul>
    <li>Media lives in one place; no dependency on Cloud‚Äôs local disk.</li>
    <li>Transfer only moves DB; URLs already point to the same bucket ‚Üí no 404s for those assets.</li>
    <li>Uploads from local or Cloud both read/write the same files.</li>
  </ul>
  <p><strong>Do you need S3 on both local and remote?</strong> Yes ‚Äì configure the <strong>same</strong> bucket in both environments. Local can use the provider so uploads go to the bucket (optional for dev; you can keep local disk for dev only). Strapi Cloud <strong>must</strong> use the provider so it serves from the bucket and does not rely on its own filesystem for uploads. One bucket, two configs (local + Cloud) pointing to that bucket is the standard setup.</p>
  <p><strong>Feasibility:</strong> Straightforward. Add the Strapi upload provider (e.g. S3), set env vars (key, secret, bucket, region, endpoint if needed), and redeploy. New uploads go to S3; for existing records you either re-upload those files or do a one-time copy of <code>public/uploads</code> into the bucket and keep URLs consistent. See <a href="STRAPI_MEDIA_STORAGE_S3_CLOUD_PRD.html">STRAPI_MEDIA_STORAGE_S3_CLOUD_PRD.html</a> for full S3/Cloud refactoring.</p>

  <h3>10.4 Alternatives to S3 (and efficiency)</h3>
  <ul>
    <li><strong>Cloudinary / other image APIs</strong> ‚Äì Same idea: one external store, configure on both envs. Often more ‚Äúimage-centric‚Äù (transformations, CDN). Efficiency is good; cost and API differ from S3.</li>
    <li><strong>Store ‚Äúa lot of images‚Äù in the database (BLOBs)</strong> ‚Äì Not recommended. Strapi does not ship with ‚Äústore file bytes in DB‚Äù as the default; you would be fighting the design, hurting DB size and backups, and still not solving the ‚ÄúCloud has no files‚Äù problem. Least efficient and not the right tool.</li>
    <li><strong>Manual copy of <code>public/uploads</code> to Cloud</strong> ‚Äì Theoretically possible (e.g. copy into Cloud‚Äôs filesystem or a volume), but Strapi Cloud‚Äôs runtime is often ephemeral, so this is fragile and not the intended pattern. Not recommended as the long-term fix.</li>
    <li><strong>S3 (or S3-compatible, e.g. R2, MinIO)</strong> ‚Äì Most efficient and robust for ‚Äúlots of images‚Äù and transfer workflow: one bucket, CDN optional, no DB bloat, works the same locally and on Cloud.</li>
  </ul>

  <h3>10.5 Quick reference: your questions answered</h3>
  <table>
    <thead>
      <tr><th>Question</th><th>Answer</th></tr>
    </thead>
    <tbody>
      <tr><td>Why 404 when we upload/import data to Strapi Cloud?</td><td>Transfer updates the DB (media entries); the actual files are not on Cloud‚Äôs disk, so <code>/uploads/...</code> 404.</td></tr>
      <tr><td>Best fix?</td><td>Use one external object store (e.g. S3) and configure Strapi to use it <strong>on Cloud</strong> (and ideally locally too).</td></tr>
      <tr><td>S3 feasible?</td><td>Yes. One bucket, env-based config; add provider and redeploy.</td></tr>
      <tr><td>S3 on both local and remote?</td><td>Yes ‚Äì configure the <strong>same</strong> bucket in both environments so both use the same media store.</td></tr>
      <tr><td>Better way without S3?</td><td>Another provider (e.g. Cloudinary) is fine; ‚Äústore in DB‚Äù is not efficient or recommended.</td></tr>
      <tr><td>Most efficient way for lots of images?</td><td>External object storage (S3 or S3-compatible) with one bucket for both envs; optional CDN in front.</td></tr>
    </tbody>
  </table>

  <h3>10.6 Bootstrap vs media</h3>
  <p><strong>Bootstrap</strong> fixes the homepage and bishop list errors; once that version is deployed to Cloud, those issues should stop. <strong>Media 404s</strong> are independent of bootstrap. They are fixed by <strong>where files are stored</strong> (external storage + same URLs), not by bootstrap. So: deploy the fixed bootstrap for admin/list behavior; add S3 (or equivalent) for media so transfer no longer leaves you with missing files and 404s.</p>

  <h2 id="quickref">11. Quick reference</h2>
  <table>
    <thead>
      <tr><th>Goal</th><th>Command / step</th></tr>
    </thead>
    <tbody>
      <tr><td>Push data to another server</td><td>On source: <code>npm run strapi transfer -- --to https://destination/admin</code> (use destination‚Äôs transfer token)</td></tr>
      <tr><td>Pull data from another server</td><td>On destination: <code>npm run strapi transfer -- --from https://source/admin</code> (use source‚Äôs transfer token)</td></tr>
      <tr><td>Export to file</td><td><code>npm run strapi export -- -f my-export</code> (add <code>-k KEY</code> or <code>--no-encrypt</code> as needed)</td></tr>
      <tr><td>Import from file</td><td><code>npm run strapi import -- -f "C:\‚Ä¶\my-export.tar.gz"</code> (Windows: use full path in quotes; add <code>-k KEY</code>, <code>--force</code> as needed)</td></tr>
      <tr><td>Restore publishedAt after import (articles/news)</td><td><code>npm run restore:article_dates_from_export</code> (set <code>EXPORT_TAR=path\to\export.tar</code> or pass path as arg)</td></tr>
      <tr><td>Avoid KnexTimeoutError during import (SQLite)</td><td>Add <code>DATABASE_CONNECTION_TIMEOUT=600000</code> to <code>.env</code> before import (see ¬ß7.3.1)</td></tr>
      <tr><td>Deploy to Strapi Cloud</td><td><code>npx strapi login</code> then <code>npx strapi deploy</code></td></tr>
      <tr><td>Transfer into Strapi Cloud</td><td>Create Push token in Cloud admin; on self-hosted: <code>strapi transfer --to https://your-project.strapiapp.com/admin</code></td></tr>
    </tbody>
  </table>

  <h2 id="docs">12. Official documentation</h2>
  <ul>
    <li><a href="https://docs.strapi.io/cms/data-management/transfer" target="_blank" rel="noopener">Data transfer (Strapi 5)</a></li>
    <li><a href="https://docs.strapi.io/cms/data-management/export" target="_blank" rel="noopener">Data export (Strapi 5)</a></li>
    <li><a href="https://docs.strapi.io/cms/data-management/import" target="_blank" rel="noopener">Data import (Strapi 5)</a></li>
    <li><a href="https://docs.strapi.io/cms/features/data-management" target="_blank" rel="noopener">Data Management feature (transfer tokens)</a></li>
    <li><a href="https://docs.strapi.io/cloud/getting-started/deployment-cli" target="_blank" rel="noopener">Strapi Cloud ‚Äì Deployment with CLI</a></li>
    <li><a href="https://github.com/strapi/strapi/pull/25268" target="_blank" rel="noopener">PR #25268 ‚Äì Import performance fix (asset metadata cache)</a></li>
  </ul>

  <script>
    (function() {
      document.querySelectorAll('pre').forEach(function(pre) {
        var wrap = document.createElement('div');
        wrap.className = 'command-wrap';
        var btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.type = 'button';
        btn.textContent = 'üìã Copy';
        btn.title = 'Copy to clipboard';
        btn.setAttribute('aria-label', 'Copy command to clipboard');
        btn.onclick = function() {
          var text = pre.textContent.trim();
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function() {
              btn.textContent = '‚úì Copied!';
              btn.classList.add('copied');
              setTimeout(function() {
                btn.textContent = 'üìã Copy';
                btn.classList.remove('copied');
              }, 2000);
            }).catch(function() {
              fallbackCopy(text, btn);
            });
          } else {
            fallbackCopy(text, btn);
          }
        };
        pre.parentNode.insertBefore(wrap, pre);
        wrap.appendChild(btn);
        wrap.appendChild(pre);
      });
      function fallbackCopy(text, btn) {
        var ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.opacity = '0';
        document.body.appendChild(ta);
        ta.select();
        try {
          document.execCommand('copy');
          btn.textContent = '‚úì Copied!';
          btn.classList.add('copied');
          setTimeout(function() {
            btn.textContent = 'üìã Copy';
            btn.classList.remove('copied');
          }, 2000);
        } catch (e) {}
        document.body.removeChild(ta);
      }
    })();
  </script>
</body>
</html>

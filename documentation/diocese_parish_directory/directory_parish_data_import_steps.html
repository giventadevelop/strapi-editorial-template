<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Directory & Parish data import steps</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.6; max-width: 900px; margin: 0 auto; padding: 2rem; color: #333; }
    h1 { color: #1a1a1a; border-bottom: 2px solid #0d5c2e; padding-bottom: 0.5rem; }
    h2 { color: #2d2d2d; margin-top: 2rem; }
    ul, ol { margin: 0.5rem 0; }
    li { margin: 0.25rem 0; }
    code, pre { background: #f0f0f0; padding: 0.2em 0.4em; border-radius: 4px; font-size: 0.9em; }
    pre { padding: 1rem; overflow-x: auto; white-space: pre-wrap; }
    a { color: #0d5c2e; }
    .note { background: #fff8e6; border-left: 4px solid #e6b800; padding: 0.75rem 1rem; margin: 1rem 0; }
  </style>
</head>
<body>
  <h1>Phase 3 – Directory import from local clone</h1>
  <p>This document describes how to run the automated import of directory data from the local clone of <a href="https://directory.mosc.in/">directory.mosc.in</a> into Strapi.</p>

  <h2>Prerequisites</h2>
  <ol>
    <li><strong>Local clone</strong> of the directory site at <code>E:\project_workspace\directory-mosc-in-temp</code> (or set <code>CLONE_DIR</code> to your path).</li>
    <li><strong>Strapi</strong> project with Phase 1 (schema) and Phase 2 (permissions) applied.</li>
    <li><strong>cheerio</strong> installed: run <code>npm install</code> in the project root (it is listed in <code>package.json</code>).</li>
  </ol>

  <h2>What the script does</h2>
  <ul>
    <li><strong>Parses</strong> (with Cheerio):
      <ul>
        <li><strong>Dioceses</strong> from <code>dioceses/index.html</code> (name, slug, address, email, phones, website, image).</li>
        <li><strong>Bishops</strong> from <code>bishops/index.html@the-holy-synod=diocesan-bishops.html</code>, <code>retired-bishops.html</code>, <code>the-primate.html</code> (name, slug, bishopType, address, email, phones, image).</li>
        <li><strong>Directory entries</strong> from <code>directories/index.html@type=*.html</code> for all seven types (name, slug, directoryType, address, email, phones, website, image).</li>
        <li><strong>Priests</strong> from diocese-based priest list pages when present (see <a href="#priest-pages">Priest list pages</a>). The live site lists priests by diocese (e.g. <a href="https://directory.mosc.in/priests/?search=&amp;diocese=637">priests/?diocese=637</a>); the script imports name, title, address, email, phones, image, and diocese relation.</li>
      </ul>
    </li>
    <li><strong>Creates</strong> in Strapi (in order): Tenant (if missing) → Dioceses → Bishops → Directory entries → Priests.</li>
    <li><strong>Uploads media</strong>: images from the clone are uploaded to Strapi and attached to dioceses, bishops, directory entries, and priests when the HTML references local image files under the clone.</li>
    <li><strong>Skips</strong> Parishes only (parish list pages are diocese-based; add parish import in a later step if needed).</li>
  </ul>

  <h2>How to run</h2>
  <p>From the project root:</p>
  <pre><code>npm run seed:data_import_seed_directory_mosc_in</code></pre>
  <p>Or with custom paths:</p>
  <pre><code># Windows (PowerShell)
$env:CLONE_DIR = "E:\project_workspace\directory-mosc-in-temp"
$env:TENANT_ID = "directory_mosc_001"
node scripts/seed-directory.js

# Linux / macOS
CLONE_DIR=/path/to/directory-mosc-in-temp TENANT_ID=directory_mosc_001 node scripts/seed-directory.js</code></pre>
  <ul>
    <li><strong>CLONE_DIR</strong> – Path to the directory.mosc.in clone (default: <code>E:\project_workspace\directory-mosc-in-temp</code>).</li>
    <li><strong>TENANT_ID</strong> – Tenant ID used for all imported directory content (default: <code>directory_mosc_001</code>). The script creates this tenant if it does not exist.</li>
  </ul>

  <h2 id="priest-pages">Priest list pages (optional)</h2>
  <p>The online directory shows priests per diocese (<strong>List by Diocese</strong> dropdown). To import priests, save the corresponding HTML for each diocese into your clone. The script looks for:</p>
  <ul>
    <li><code>priests/priests.html@diocese=&lt;id&gt;.html</code></li>
    <li><code>priests/index.html@diocese=&lt;id&gt;.html</code></li>
    <li><code>priests@diocese=&lt;id&gt;.html</code> or <code>priests.html@diocese=&lt;id&gt;.html</code> at clone root</li>
  </ul>
  <p>where <code>&lt;id&gt;</code> is the diocese value from <code>priests.html</code> (e.g. <code>637</code> for Diocese of Adoor- Kadampanad). Save e.g. <code>https://directory.mosc.in/priests/?search=&amp;diocese=637</code> as <code>priests/priests.html@diocese=637.html</code> (create a <code>priests</code> folder if needed). Run the import after saving one or more such pages.</p>

  <h2>After import</h2>
  <ol>
    <li>Open Strapi Admin and check <strong>Directory – Dioceses</strong>, <strong>Directory – Bishops</strong>, <strong>Directory – Entries</strong>, and <strong>Directory – Priests</strong> (if priest list pages were present).</li>
    <li>To show directory data on the frontend, filter by tenant, e.g.<br>
      <code>GET /api/dioceses?filters[tenant][tenantId][$eq]=directory_mosc_001</code>.</li>
    <li>Optionally create <strong>Directory – Home</strong> section cards manually (or extend the script to parse <code>index.html</code> and create the Directory Home single type).</li>
    <li>Parishes are not imported from this clone; add them manually or from another data source.</li>
  </ol>

  <h2>Re-running</h2>
  <div class="note">
    The script does not check for existing entries. Re-running will create duplicates (e.g. duplicate dioceses/bishops/entries). To re-import, delete the existing directory content for that tenant in Admin, or clear the database, then run again.
  </div>
</body>
</html>
